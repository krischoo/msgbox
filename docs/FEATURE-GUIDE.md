# msgbox 기능 가이드

## 개요

msgbox는 [addy.io](https://addy.io) (구 AnonAddy)를 기반으로 한 **익명 이메일 포워딩 서비스**입니다.
실제 이메일 주소를 숨기고, 무제한 별칭(alias)을 생성하여 프라이버시를 보호합니다.

---

## 핵심 개념

### 이메일 포워딩이란?

```
발신자                    msgbox                    수신자 (나)
┌──────────┐            ┌──────────┐            ┌──────────┐
│ 쇼핑몰    │  ──────►  │  별칭     │  ──────►  │ 실제     │
│ 뉴스레터  │           │ shop@    │           │ 이메일    │
│ 서비스    │           │ msgbox.kr │           │ me@     │
└──────────┘            └──────────┘            │ gmail   │
                              │                 └──────────┘
                              │
                        스팸 발생 시
                        별칭 비활성화
                              ↓
                        ✗ 더 이상 수신 안함
```

**핵심 원리:**
- 서비스마다 **다른 별칭**을 사용
- 스팸 발생 시 **해당 별칭만 비활성화**
- 실제 이메일 주소는 **절대 노출되지 않음**

---

## 주요 기능

### 1. 별칭 (Alias) 관리

#### 별칭 유형

| 유형 | 예시 | 설명 |
|------|------|------|
| **표준 별칭** | `shop@username.msgbox.kr` | 사용자명 서브도메인 사용 |
| **공유 도메인 별칭** | `random123@msgbox.kr` | 공유 도메인 사용 (사전 생성 필요) |
| **커스텀 도메인 별칭** | `anything@mydomain.com` | 자신의 도메인 사용 |
| **랜덤 문자 별칭** | `a8d9f2@msgbox.kr` | 무작위 문자열 |
| **랜덤 단어 별칭** | `happy-tiger@msgbox.kr` | 기억하기 쉬운 단어 조합 |

#### On-the-Fly 별칭 생성

표준 별칭은 **즉석에서 생성** 가능합니다:

```
사이트 가입 시 → newsite@username.msgbox.kr 입력
                        ↓
              자동으로 별칭 생성 & 이메일 수신
```

별도로 대시보드에서 미리 만들 필요 없이, 아무 주소나 입력하면 자동 생성됩니다.

#### 별칭 상태

| 상태 | 아이콘 | 동작 |
|------|--------|------|
| 활성 | ✅ | 이메일 수신 및 포워딩 |
| 비활성 | ⏸️ | 이메일 수신 거부 (발신자에게 반송) |
| 삭제됨 | ❌ | 완전 삭제 (복구 불가) |

---

### 2. 수신자 (Recipient) 관리

여러 개의 실제 이메일 주소를 등록하고, 별칭마다 다른 수신자를 지정할 수 있습니다.

```
별칭: work@username.msgbox.kr     →  회사이메일@company.com
별칭: personal@username.msgbox.kr →  개인이메일@gmail.com
별칭: spam@username.msgbox.kr     →  임시이메일@temp.com
```

#### 다중 수신자

하나의 별칭에 **여러 수신자**를 지정할 수 있습니다:

```
별칭: team@username.msgbox.kr
         ├──► member1@gmail.com
         ├──► member2@gmail.com
         └──► member3@gmail.com
```

---

### 3. 커스텀 도메인

자신의 도메인을 연결하여 `*@mydomain.com` 형태의 별칭을 사용할 수 있습니다.

#### 설정 단계

1. **도메인 소유권 인증** - TXT 레코드 추가
2. **MX 레코드 설정** - 메일 수신 설정
3. **SPF/DKIM 설정** - 발신 인증 (선택)

#### DNS 설정 예시

```
# MX 레코드
@    MX    10    msgbox.kr

# TXT 레코드 (소유권 인증)
@    TXT   "addy-site-verification=abc123..."

# SPF 레코드 (발신 인증)
@    TXT   "v=spf1 include:msgbox.kr -all"
```

---

### 4. 답장 및 발신

별칭으로 받은 이메일에 **답장**하거나, 별칭을 사용하여 **새 이메일을 발송**할 수 있습니다.

#### 답장 방법

```
1. 포워딩된 이메일에서 "답장" 클릭
2. 자동으로 별칭 주소로 발신
3. 수신자는 실제 이메일 주소를 볼 수 없음
```

#### 새 이메일 발송

```
받는 사람: recipient+별칭@msgbox.kr

예시:
- hello@gmail.com에게 shop@username.msgbox.kr로 발송하려면:
- 받는 사람: hello=gmail.com@shop.username.msgbox.kr
```

---

### 5. GPG/PGP 암호화

이메일을 **종단간 암호화**하여 프라이버시를 극대화할 수 있습니다.

#### 설정 방법

1. 수신자 설정에서 **공개 키 추가**
2. 모든 포워딩 이메일이 **자동 암호화**됨
3. 본인의 **개인 키**로만 복호화 가능

#### 암호화 범위

- ✅ 이메일 본문
- ✅ 첨부파일
- ✅ 제목 (Protected Headers 지원)

---

### 6. 규칙 (Rules)

조건에 따라 이메일을 자동 처리할 수 있습니다.

#### 규칙 조건

| 조건 | 설명 |
|------|------|
| 발신자 | 특정 이메일 주소에서 온 메일 |
| 제목 | 특정 키워드가 포함된 메일 |
| 별칭 | 특정 별칭으로 수신된 메일 |

#### 규칙 동작

| 동작 | 설명 |
|------|------|
| 포워딩 | 특정 수신자에게만 전달 |
| 차단 | 이메일 수신 거부 |
| 배너 제거 | 배너 정보 제거 후 전달 |

---

### 7. 배달 실패 관리

이메일 전달에 실패한 경우, 로그를 확인하고 재전송할 수 있습니다.

#### 실패 원인

- 수신자 이메일 주소 오류
- 수신자 메일서버 거부
- 메일 크기 초과
- 스팸 필터링

---

## 제한 사항

### 기술적 한계

| 항목 | 제한 |
|------|------|
| **최대 이메일 크기** | 25MB |
| **별칭당 수신자 수** | 10명 |
| **월간 대역폭** | 설정에 따름 |
| **별칭 개수** | 무제한 (self-hosted) |

### 이것은 메일함이 아닙니다

```
❌ msgbox는 이메일을 저장하지 않습니다
❌ 웹에서 이메일을 읽을 수 없습니다
❌ 메일 검색 기능이 없습니다

✅ 오직 "포워딩"만 수행합니다
✅ 이메일은 실제 메일함(Gmail 등)에서 확인합니다
```

### 도메인 제약

- 커스텀 도메인은 **수신자로 동시 사용 불가**
- 예: `mydomain.com`을 추가하면 `me@mydomain.com`을 수신자로 설정 불가
- 해결책: 서브도메인 사용 (`mail.mydomain.com`)

### 스팸 관련

- 포워딩된 이메일을 **스팸으로 신고하면 안됨**
- 스팸 메일 수신 시 **별칭을 비활성화**하는 것이 올바른 방법
- 반복 스팸 신고 시 계정 비활성화 가능

---

## 확장 기능

### API 지원

REST API를 통해 프로그래밍 방식으로 별칭을 관리할 수 있습니다.

```bash
# 별칭 목록 조회
curl -H "Authorization: Bearer {API_TOKEN}" \
     https://msgbox.kr/api/v1/aliases

# 새 별칭 생성
curl -X POST \
     -H "Authorization: Bearer {API_TOKEN}" \
     -d '{"domain": "msgbox.kr", "description": "Test"}' \
     https://msgbox.kr/api/v1/aliases
```

### 브라우저 확장 프로그램

- [Firefox 확장](https://addons.mozilla.org/firefox/addon/addy_io/)
- [Chrome 확장](https://chrome.google.com/webstore/detail/addyio/iadbdpnoknmbdeolbapdackdcogdmjpe)

### 모바일 앱

- [Android 앱](https://play.google.com/store/apps/details?id=host.stjin.anonaddy)
- [iOS 앱](https://apps.apple.com/app/addy-io/id6563138633)

---

## 사용 시나리오

### 1. 서비스별 별칭 사용

```
쇼핑몰 가입   → shopping@username.msgbox.kr
뉴스레터 구독 → newsletter@username.msgbox.kr
SNS 가입     → social@username.msgbox.kr
```

**장점:** 어떤 서비스가 이메일을 유출했는지 추적 가능

### 2. 임시 이메일 대체

```
일회성 가입 → temp123@username.msgbox.kr
            (나중에 삭제)
```

**장점:** 임시 이메일 서비스와 달리 언제든 복구 가능

### 3. 팀 이메일 관리

```
support@company.com → 팀원 3명에게 동시 전달
sales@company.com   → 영업팀에게 전달
```

**장점:** 그룹 이메일 없이도 팀 협업 가능

---

## 발전 방향 제안

### 단기 개선 사항

| 항목 | 설명 | 우선순위 |
|------|------|----------|
| **한국어 UI** | 인터페이스 한국어화 | 높음 |
| **대시보드 개선** | 통계, 차트 강화 | 중간 |
| **모바일 반응형** | 모바일 UI 최적화 | 중간 |

### 중기 개선 사항

| 항목 | 설명 | 우선순위 |
|------|------|----------|
| **웹훅 지원** | 이메일 수신 시 외부 서비스 호출 | 높음 |
| **2FA 강화** | TOTP, WebAuthn 지원 강화 | 중간 |
| **로그 분석** | 이메일 트래픽 분석 대시보드 | 낮음 |

### 장기 발전 방향

| 항목 | 설명 |
|------|------|
| **캘린더 초대 처리** | iCal 첨부파일 특별 처리 |
| **AI 스팸 필터** | 머신러닝 기반 스팸 탐지 |
| **임시 저장소** | 선택적으로 최근 N개 이메일 저장 |
| **SMTP 발신** | 별도 SMTP 서버 없이 직접 발신 |

### 고려할 신규 기능

```
1. 이메일 미리보기
   - 포워딩 전 웹에서 미리보기
   - 스팸/피싱 의심 메일 확인 후 전달

2. 스케줄 포워딩
   - 특정 시간에만 이메일 전달
   - 업무 시간 외 이메일 차단

3. 자동 응답
   - 부재중 자동 응답
   - 템플릿 기반 자동 회신

4. 별칭 만료
   - 일정 기간 후 자동 비활성화
   - 일회성 별칭 관리 용이
```

---

## 보안 고려사항

### 현재 보안 기능

- ✅ GPG/PGP 암호화
- ✅ DKIM 서명
- ✅ SPF 인증
- ✅ TLS 전송 암호화
- ✅ 2FA (이중 인증)

### 추가 권장 사항

- 정기적인 API 토큰 갱신
- 사용하지 않는 별칭 정리
- 수신자 이메일 보안 강화 (Gmail 2FA 등)

---

## 참고 자료

- [addy.io 공식 문서](https://addy.io/help/)
- [addy.io GitHub](https://github.com/anonaddy/anonaddy)
- [API 문서](https://app.addy.io/docs/)
